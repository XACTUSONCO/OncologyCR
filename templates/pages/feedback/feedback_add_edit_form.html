{% load chunks from research_tag %}
{% load get_m2m_values from research_tag %}

<div class="form-group row">
  <label for="cycle" class="col-sm-3 col-form-label">Cycle</label>
  <div class="col-sm-9">
    <input type="text" class="form-control" name="cycle" value="{{ feedback.cycle }}" placeholder="ex) C1D4 -> 1, EOT">
    <div class="text-danger">
      <p class="mb-1 f_ss">※ 숫자 형식이 아닌 텍스트 입력 시, 텍스트만 출력됩니다.</p>
      <p class="mb-1 f_ss">※ unscheduled visit 의 경우, 'USV' 로 입력 부탁드립니다.</p>
      <p class="mb-1 f_ss">※ screening 의 경우, ICF date 항목만 입력 부탁드립니다.<br>
        ex) cycle 항목: "scr", "screening", "ICF", "SAE", "OP" 등 입력 X</p>
    </div>
  </div>

  <label for="day" class="col-sm-3 col-form-label">Day</label>
  <div class="col-sm-9">
    <input type="text" class="form-control input-width33" name="day" value="{{ feedback.day }}" placeholder="ex) C1D4  -> 4">
  </div>
</div>

<div class="form-group row">
  <label for="dosing_date" class="col-sm-3 col-form-label">Visit Date</label>
  <div class="col-sm-9">
    <div class="month-inputs input-group">
      <input class="form-control" data-provide="datepicker" id="dosingdate" name="dosing_date" autocomplete="off"
             value="{{ feedback.dosing_date|date:"m/d/Y" }}"
             >
      <label for="dosingdate" class="input-group-text"><i class="bi bi-calendar-check"></i></label>
    </div>
  </div>
</div>

<div class="form-group row">
  <label for="next_visit" class="col-sm-3 col-form-label">Next Visit Date</label>
  <div class="col-sm-9">
    <div class="month-inputs input-group">
      <input autocomplete="off" class="form-control" data-provide="datepicker" type="text" id="nextvisit" name="next_visit"
             value="{{ feedback.next_visit|date:"m/d/Y" }}">
      <label for="nextvisit" class="input-group-text"><i class="bi bi-calendar-check"></i></label>
    </div>
  </div>
</div>

<div class="form-group row">
  <label for="tx_dose" class="col-sm-3 col-form-label">Tx, Dose</label>
  <div class="col-sm-9">
    <input type="text" class="form-control" name="tx_dose" value="{{ feedback.tx_dose }}" placeholder="ex) avelumab 10mg/kg">
  </div>
</div>

<div class="form-group row">
  <label for="photo_date" class="col-sm-3 col-form-label">Imaging Date</label>
  <div class="col-sm-9">
    <div class="row">
      <div class="col-sm-4">
        <div class="input-group">
          <input type="text" id="photodate" name="photo_date" class="form-control" data-provide="datepicker" placeholder="(imaging date)" value="{{ feedback.photo_date|date:"m/d/Y" }}">
          <label for="photodate" class="input-group-text"><i class="bi bi-calendar-check"></i></label>
        </div>
      </div>
      <div class="col-sm-3">
        <select id="cars" name="response" class="form-select">
          <option value="">response</option>
          <option value="CR" {% if "CR" == feedback.response %} selected {% endif %}>CR</option>
          <option value="PR" {% if "PR" == feedback.response %} selected {% endif %}>PR</option>
          <option value="SD" {% if "SD" == feedback.response %} selected {% endif %}>SD</option>
          <option value="PD" {% if "PD" == feedback.response %} selected {% endif %}>PD</option>
          <option value="ND" {% if "ND" == feedback.response %} selected {% endif %}>ND</option>
        </select>
      </div>
      <div class="col-sm-5">
        <input type="text" class="form-control" name="response_text" value="{{ feedback.response_text }}" placeholder="ex) Baseline or 1st or (-8.5%)">
      </div>
    </div>
  </div>
</div>

<div class="form-group row">
  <label for="toxicity" class="col-sm-3 col-form-label">Toxicity</label>
  <div class="col-sm-9">
      <textarea class="form-control" name="toxicity" rows="4">{{ feedback.toxicity }}</textarea>
    </div>
</div>

<div class="form-group row">
  <label for="comment" class="col-sm-3 col-form-label">Comment</label>
  <div class="col-sm-9">
    <textarea class="form-control" name="comment" rows="4">{% if feedback.comment %}{{ feedback.comment }}{% endif %}</textarea>
  </div>
</div>

<div class="form-group row">
  <label for="ICF_date" class="col-sm-3 col-form-label">ICF Date</label>
  <div class="col-sm-9">
    <div class="month-inputs input-group">
      <input autocomplete="off" class="form-control" data-provide="datepicker" type="text" id="ICFdate" name="ICF_date"
             value="{{ feedback.ICF_date|date:"m/d/Y" }}">
      <label for="ICFdate" class="input-group-text"><i class="bi bi-calendar-check"></i></label>
    </div>
  </div>
</div>

<div class="form-group row">
  <label for="scr_fail" class="col-sm-3 col-form-label">Screening Fail Date</label>
  <div class="col-sm-9">
    <div class="month-inputs input-group">
      <input autocomplete="off" class="form-control" data-provide="datepicker" type="text" id="scrfail" name="scr_fail"
             value="{{ feedback.scr_fail|date:"m/d/Y" }}">
      <label for="scrfail" class="input-group-text"><i class="bi bi-calendar-check"></i></label>
    </div>
  </div>
</div>

<div class="form-group row {% if 'FU' in errors %} card-inverse-danger {% endif %}">
  <label for="FU" class="col-sm-3 col-form-label">FU or EOS<br>(EOT 시, 필수 선택)
    {% autoescape off %}
      {% if 'FU' in errors %}
        <div class="text-danger small" style="line-height: 1rem;">{{ errors.FU }}</div>
      {% endif %}
    {% endautoescape %}
  </label>
  <div class="col-sm-9">
    <div class="row row-cols-auto align-items-center">
        {% for value, text in field_choice.fu %}
          <div class="col">
            <div class="form-check form-check-success">
              <label class="form-check-label">
                <input type="checkbox" class="form-check-input" name="FU" value="{{ value }}"
                    {% if value in feedback.fu.all|get_m2m_values %}
                       checked {% endif %}
                    {% if not editable %} disabled {% endif %}>
                <i class="input-helper"></i><span class="form-check-sign">{{ text }}</span>
              </label>
            </div>
          </div>
        {% endfor %}

      <div class="col">EOS:</div>
      <div class="col">
        <select name="eos" class="form-select">
          <option value="">------------</option>
          <option value="death" {% if "death" == feedback.eos.value %} selected {% endif %}>사망</option>
          <option value="withdrawal" {% if "withdrawal" == feedback.eos.value %} selected {% endif %}>동의철회</option>
          <option value="completion" {% if "completion" == feedback.eos.value %} selected {% endif %}>완료</option>
          <option value="etc" {% if "etc" == feedback.eos.value %} selected {% endif %}>기타</option>
        </select>
      </div>
    </div>
  </div>
</div>

<div class="form-group row {% if 'is_accompany' in errors %} card-inverse-danger {% endif %}">
  <label for="is_accompany" class="col-sm-3 col-form-label">FU 환자인 경우, <br/>외래 동행 여부
    {% autoescape off %}
      {% if 'is_accompany' in errors %}
        <div class="text-danger small" style="line-height: 1rem;">{{ errors.is_accompany }}</div>
      {% endif %}
    {% endautoescape %}
  </label>
  <div class="col-sm-9">
    <div class="row row-cols-auto">
      <div class="col">
        <div class="form-check form-check-success">
          <label class="form-check-label">
            <input type="radio" class="form-check-input" name="is_accompany" value="1" {% if '1' == feedback.is_accompany %} checked {% endif %}>
            <i class="input-helper"></i><span class="form-check-sign">Yes</span>
          </label>
        </div>
      </div>

      <div class="col">
        <div class="form-check form-check-success">
          <label class="form-check-label">
            <input type="radio" class="form-check-input" name="is_accompany" value="0" {% if '0' == feedback.is_accompany or feedback.is_accompany == null %} checked {% endif %}>
            <i class="input-helper"></i><span class="form-check-sign">No</span>
          </label>
        </div>
      </div>
    </div>
  </div>
</div>
