{% extends "bases/base_generic.html" %}
{% load static %}
{% load cal_career from research_tag %}
{% load get_o2m_values from research_tag %}

	{% block content %}
		<div class="page-content">
			<div class="container-fluid">
				<div class="bg-overlay bg-white"></div>

				<!-- start page title -->
				<div class="row">
					<div class="col-12">
						<div class="page-title-box d-flex align-items-center justify-content-between">
							<h2>교육일정</h2>

							<button id="print" type="button" class="btn btn-outline-secondary print_btn"><i class="bi bi-printer"></i> <span class="invisible-">화면 프린트</span></button>
							<div class="page-nav">
								<ul class="breadcrumb">
									<li class="breadcrumb-item"><a href="/"> <i class="bi bi-house"></i> </a></li>
									<li class="breadcrumb-item">Staff</li>
									<li class="breadcrumb-item"><a href="/dataroom/crc/check_list/">교육일정</a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
				<!-- end page title -->

				<!-- start sub-menu-tabs-->
				<div class="row">
					<div class="col-12">
						<div class="sub-menu-tabs">
							<ul id="submenu-tab">
								<li><a href="/dataroom/crc/check_list/"><i></i> 교육일정</a></li>
								<li><a href="/dataroom/educational_material/"><i></i> 교육자료</a></li>
							</ul>
						</div>
					</div>
				</div>
				<!-- end sub-menu-tabs -->

				<!-- start contents-area -->
				<div class="row" id="printArea">
					<div class="col-12 education-schedule">
						<div id='calendar-container'>
							<div id='calendar'></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	{% endblock %}

{% block script %}
<!-- studies 페이지용 js -->
<script src="{% static 'assets/js/pages/staff3.js' %}"></script>
<script>
	document.addEventListener('DOMContentLoaded', function() {
		var calendarEl = document.getElementById('calendar');
		var calendar = new FullCalendar.Calendar(calendarEl, {
			initialView: "dayGridMonth",
			locale: 'ko',
			events: {
				url: '/dataroom/crc/all_events'
			},
			height: 'auto',
			expandRows: true,
			eventColor: '#787dec',//월차.
			eventClick: function (info) {
						var eventID = info.event.id;
						var eventDate = info.event.start;

						var koreanOffset = 9 * 60; // 분 단위로 오프셋 계산, 한국 시간대 오프셋 (KST, UTC+09:00) 적용
						eventDate.setMinutes(eventDate.getMinutes() + koreanOffset); // 날짜 객체에 오프셋을 더함

						var year = eventDate.getFullYear();
						var month = ('0' + (eventDate.getMonth() + 1)).slice(-2);
						var day = ('0' + eventDate.getDate()).slice(-2);
						var hour = ('0' + eventDate.getHours()).slice(-2);
						var minute = ('0' + eventDate.getMinutes()).slice(-2);
						var formattedDateTime = year + '-' + month + '-' + day + ' ' + hour + ':' + minute;
						window.location.href = '/dataroom/crc/training/edit/' + eventID + '/?from_date=' + formattedDateTime;
			},
			dateClick: function (info) {
						var Date = info.date;
						var year = Date.getFullYear();
						var month = ('0' + (Date.getMonth() + 1)).slice(-2);
						var day = ('0' + Date.getDate()).slice(-2);
						var hour = ('0' + Date.getHours()).slice(-2);
						var minute = ('0' + Date.getMinutes()).slice(-2);
						var formattedDateTime = year + '-' + month + '-' + day + ' ' + hour + ':' + minute;
						window.location.href = '/dataroom/crc/training/add/?from_date=' + formattedDateTime
			},
			eventDidMount: function(info) {
					  var eventDate = new Date(info.event.start);
					  var koreanOffset = 9 * 60; // 분 단위로 오프셋 계산
					  eventDate.setMinutes(eventDate.getMinutes() + koreanOffset);
					  var hour = ('0' + eventDate.getHours()).slice(-2);
					  var minute = ('0' + eventDate.getMinutes()).slice(-2);
					  var formattedTime = hour + ':' + minute;

					  info.el.querySelector('.fc-event-time').textContent = formattedTime;  // .fc-event-time 엘리먼트에 한국 시간을 설정
			}
		  });
		calendar.render();
	});

    $(document).ready(function() {
        $('.category-certificate-table').DataTable( {
          initComplete: function () {
            this.api().columns([]).every( function () {
                var column = this;
                var colTitle = this.header().innerHTML;
                var select = $('<select><option value="" selected>' + colTitle + '</option></select>')
                    .appendTo( $(column.header()).empty() )
                    .on( 'change', function () {
                      var val = $.fn.dataTable.util.escapeRegex(
                        $(this).val()
                      );
                      column
                          .search( val ? '^'+val+'$' : '', true, false )
                          .draw();
                    } );

                column.data().unique().sort().each( function ( d, j ) {
                  select.append( '<option>'+d+'</option>' )
                } );
            } );
          }
        });
      });
</script>
{% endblock %}
